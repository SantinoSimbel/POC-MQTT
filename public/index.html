<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MQTT Test</title>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <script>
    // pagina web a visitar para hacer el test:
    // https://www.hivemq.com/demos/websocket-client/?
    const client = mqtt.connect('ws://localhost:9001'); //se conecta al broker(servidor intermediario que gestiona la transmision de mensajes entre clientes), el ws del principo significa websocket.

    client.on("connect", () => {
      console.log('Conectado al broker MQTT desde el cliente');
      
      client.subscribe('time', { qos: 1 }, (error) => {
        if (error) {
            console.log('Error al suscribirse', error);
        } else {
            setInterval(() => {
            let date = new Date(); 
            let hour = date.getHours();
            let minutes = date.getMinutes();
            let seconds = date.getSeconds();
            hour =  hour < 10 ? "0" + hour : hour;
            minutes =  minutes < 10 ? "0" + minutes : minutes;
            seconds =  seconds < 10 ? "0" + seconds : seconds;
            let time = `${hour}:${minutes}:${seconds}`;
            //const time = date.toTimeString(); //Agarro la hora de la Date y la convierto a string
            client.publish('time', time, { qos: 1 }); // QoS 1 para compararlo mejor con websockets
          }, 5000);
        }
      });
    });
    client.on("message", (topic, message) => {
      document.getElementById("output").innerText += message.toString() + "\n";
    });
  </script>
</head>

<body>
  <h1>MQTT Test</h1>
  <pre id="output"></pre> <!-- SecciÃ³n para mostrar mensajes recibidos -->
</body>

</html>